<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="./jquery-3.4.1.min.js"></script>
    <title>Document</title>
</head>
<body>
<input id="imgup" name="img" type="file"/>
<button id="uploadimg" onclick="uploadimg">올리기</button>

<script type="text/javascript">

    /* IMGUR 파일 업로드 함수
    @param file : 파일데이터
    @param callback : 콜백함수 */


    const submitButton = document.querySelector("#uploadimg")
    submitButton.addEventListener("click", imgupload)


    function uploadImageByImgur(file, callback) {
        form = new FormData();
        form.append('image', file);
        $.ajax({
            req: function () {
                const req = new window.XMLHttpRequest();
                req.upload.addEventListener("progress", function (event) { // 업로드상태이벤트리스너등록
                    if (event.lengthComputable) {
                        console.log("업로드 진행률:" + parseInt((event.loaded / event.total * 100), 10) + "%");
                    }
                }, false);
                return req
            },
            url: 'https://api.imgur.com/3/image',// 업로드요청주소
            headers: {Authorization: 'Client-ID 24321b230a75815'},
            type: 'POST',
            data: form,
            cache: false,
            contentType: false,
            processData: false
        }).always(callback);
    }

    /* 파일 변경 이벤트가 감지되면 자동으로 이미지 업로드 */
    function imgupload() { // 사용자가 파일을 변경했을때 발생됨
        const inputImg = document.querySelector("#imgup");
        if (inputImg.files.length === 1) {
            const file = inputImg.files[0];
            uploadImageByImgur(file, function (result) {
                console.log(result);
                console.log('업로드결과:' + result.status);

                if (result.status != 200) {
                    result = $.parseJSON(result.responseText);
                }
                if (result.data.error) {
                    console.log('지원하지않는 파일형식..');
                } else {
                    console.log('업로드된 파일경로:' + result.data.link);
                }
            });
        }
    };

    //
    // $(document).ready(function () { // document가 모두 로드되면 실행됨
    //     $("input[name=img]").change(function () {// 사용자가 파일을 변경했을때 발생됨
    //         var file = this.files[0];
    //         uploadImageByImgur(file, function (result) {
    //             console.log(result);
    //             console.log('업로드결과:' + result.status);
    //
    //             if (result.status != 200) {
    //                 result = $.parseJSON(result.responseText);
    //             }
    //             if (result.data.error) {
    //                 console.log('지원하지않는 파일형식..');
    //             } else {
    //                 console.log('업로드된 파일경로:' + result.data.link);
    //             }
    //         });
    //     });
    // });

</script>

</body>
</html>